import{_ as X,a as Y,v as Z}from"./v4.3a81ebd7.js";import{_ as ee}from"./index.7c79cfa9.js";import{_ as te}from"./nuxt-link.12cff8ed.js";import{u as oe}from"./index.d52611df.js";import{D as _,a as g,C as b,s as I,S as N}from"./appwrite.a78840d9.js";import{f as ae,g as se,r as L,h as re,i as le,o as T,c as k,a as n,t as v,j as e,b as r,m as x,k as h,l as ne,w as y,n as ue,d as S}from"./entry.4f10bab2.js";import{u as me,a as q}from"./vee-validate.esm.8c3564f4.js";import{u as R}from"./useQuery.3635eb87.js";const ie={class:"p-10"},ce={class:"font-bold md:text-2xl text-xl mb-10"},de=["src"],fe={class:"grid w-full max-w-sm items-center gap-1.5 border-[#161c26] mb-4 placeholder:text-[#748092] focus:border-border transition-colors"},pe=n("div",{class:"text-sm mb-2"},"Logo",-1),Fe=ae({__name:"[id]",setup(_e){const A=se(),i=L(""),c=L(!1);oe({title:"Company Editing"});const{data:K,isLoading:ge}=R({queryKey:["customers"],queryFn:()=>_.listDocuments(g,b)}),u=re().params.id,{handleSubmit:O,defineField:d,setFieldValue:P,setValues:$,values:V}=me(),{data:C,isSuccess:M}=R({queryKey:["get customer",u],queryFn:()=>_.getDocument(g,b,u)});le(M,()=>{const t=C.value;$({email:t.email,avatar_url:t.avatar_url,from_source:t.from_source||"",name:t.name})});const[m,j]=d("name"),[l,z]=d("email"),[f,G]=d("from_source"),{mutate:Q,isPending:D}=q({mutationKey:["update customer",u],mutationFn:t=>_.updateDocument(g,b,u,t)}),{mutate:W,isPending:F}=q({mutationKey:["upload image"],mutationFn:t=>I.createFile(N,Z(),t),onSuccess(t){const o=I.getFileDownload(N,t.$id);P("avatar_url",o.href)}}),w=O(t=>{var s;const o=(s=K.value)==null?void 0:s.documents.find(p=>p.email===l.value);m.value&&l.value&&!o?(Q(t),setTimeout(()=>{A.push("/customers")},1e3)):(c.value=!0,setTimeout(()=>{c.value=!1},5e3),o?i.value="Such customer already exists":i.value="Fields 'name' and 'email' are required")});return(t,o)=>{var E;const s=X,p=ee,H=te,J=Y;return T(),k("div",ie,[n("h1",ce," Editing "+v((E=e(C))==null?void 0:E.name),1),n("form",{onSubmit:o[3]||(o[3]=(...a)=>e(w)&&e(w)(...a)),class:"form"},[r(s,x({placeholder:"Name",modelValue:e(m),"onUpdate:modelValue":o[0]||(o[0]=a=>h(m)?m.value=a:null)},e(j),{type:"text",class:"border-[#161c26] mb-4 placeholder:text-[#748092] focus:border-border transition-colors"}),null,16,["modelValue"]),r(s,x({placeholder:"Email",modelValue:e(l),"onUpdate:modelValue":o[1]||(o[1]=a=>h(l)?l.value=a:null)},e(z),{type:"text",class:"border-[#161c26] mb-4 placeholder:text-[#748092] focus:border-border transition-colors"}),null,16,["modelValue"]),r(s,x({placeholder:"Where has he/she come from?",modelValue:e(f),"onUpdate:modelValue":o[2]||(o[2]=a=>h(f)?f.value=a:null)},e(G),{type:"text",class:"border-[#161c26] mb-4 placeholder:text-[#748092] focus:border-border transition-colors"}),null,16,["modelValue"]),e(V).avatar_url||e(F)?(T(),k("img",{key:0,src:e(V).avatar_url,alt:"",width:"50",height:"50",class:"rounded-full my-4"},null,8,de)):ne("",!0),n("div",fe,[n("label",null,[pe,r(s,{type:"file",onchange:a=>{var U,B;return((B=(U=a==null?void 0:a.target)==null?void 0:U.files)==null?void 0:B.length)&&e(W)(a.target.files[0])},disabled:e(F)},null,8,["onchange","disabled"])])]),r(p,{disabled:e(D),variant:"secondary",class:"mt-3 mr-2"},{default:y(()=>[S(v(e(D)?"Loading...":"Save"),1)]),_:1},8,["disabled"]),r(H,{href:"/customers",class:"bg-secondary text-secondary-foreground shadow-sm hover:bg-[#354359] py-1 px-2 rounded-md"},{default:y(()=>[S(" Cancel ")]),_:1}),r(J,{class:ue([{"opacity-100":c.value},"text-[#ffffff] bg-[#ff0000] mx-auto mt-4 max-w-xs transition-opacity opacity-0 text-center"]),variant:"outline"},{default:y(()=>[S(v(i.value),1)]),_:1},8,["class"])],32)])}}});export{Fe as default};
